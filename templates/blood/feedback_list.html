{% load static %}
{% load math_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Community Feedback - BloodBridge</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh}
        .wrap{max-width:1200px;margin:0 auto;padding:90px 15px 40px}
        .head{display:flex;align-items:flex-end;justify-content:space-between;gap:14px;flex-wrap:wrap;margin-bottom:22px}
        .title{margin:0;font-weight:900;color:#0f172a}
        .sub{margin-top:6px;color:#64748b}
        .btn-main{border-radius:14px;font-weight:900;border:0;color:#fff;background:linear-gradient(45deg,#e74c3c,#c0392b);box-shadow:0 10px 28px rgba(231,76,60,0.25)}
        .btn-soft{border-radius:14px;font-weight:900}
        .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px}
        @media(max-width:992px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
        @media(max-width:600px){.grid{grid-template-columns:1fr}}
        .cardx{background:#fff;border-radius:18px;box-shadow:0 18px 55px rgba(0,0,0,0.10);border:1px solid rgba(226,232,240,0.9);overflow:hidden}
        .cardb{padding:18px}
        .top{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
        .name{font-weight:900;color:#0f172a}
        .meta{color:#64748b;font-weight:700;font-size:0.9rem}
        .stars{color:#f1c40f;letter-spacing:1px;margin-top:6px}
        .msg{color:#1f2937;margin-top:10px;line-height:1.6;white-space:pre-wrap}
        .imgs{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
        .img{width:96px;height:78px;border-radius:14px;object-fit:cover;border:1px solid rgba(226,232,240,0.9)}
        .admin{margin-top:12px;padding:10px 12px;border-radius:14px;background:rgba(102,126,234,0.08);border:1px solid rgba(102,126,234,0.18)}
        .adminhead{display:flex;align-items:center;justify-content:space-between;gap:10px}
        .admintitle{font-weight:900;color:#334155}
        .reaction{font-size:1.2rem}
        .pager{margin-top:22px;display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}
        .pagebtn{border-radius:12px;font-weight:900}
        .pill{display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:5px 10px;font-weight:900;font-size:0.82rem;border:1px solid rgba(226,232,240,0.9);background:rgba(248,250,252,0.95);color:#334155}
    </style>
</head>
<body>
<div class="wrap">
    <div class="head">
        <div>
            <h2 class="title"><i class="fas fa-comment-dots" style="color:#e74c3c"></i> Community Feedback</h2>
            <div class="sub">All public reviews from donors and patients.</div>
        </div>
        <div class="d-flex" style="gap:10px;flex-wrap:wrap;">
            <a class="btn btn-main px-4" href="{% url 'public-feedback' %}"><i class="fas fa-pen"></i> Share Feedback</a>
            <a class="btn btn-outline-secondary btn-soft" href="{% url 'home' %}"><i class="fas fa-arrow-left"></i> Home</a>
        </div>
    </div>

    {% if page_obj.object_list %}
        <div class="grid">
            {% for fb in page_obj.object_list %}
                <div class="cardx">
                    <div class="cardb">
                        <div class="top">
                            <div>
                                <div class="name">{{ fb.author_label }}</div>
                                <div class="meta">{{ fb.feedback_for }} • {{ fb.created_at|date:"d M Y" }}</div>
                                <div class="stars">
                                    {% star_range as stars %}
                                    {% for i in stars %}{% if fb.rating >= i %}★{% else %}☆{% endif %}{% endfor %}
                                </div>
                            </div>
                            <div>
                                {% if fb.admin_reaction %}<span class="pill" title="Admin reaction">{{ fb.admin_reaction }}</span>{% endif %}
                            </div>
                        </div>

                        <div class="msg">{{ fb.message }}</div>

                        {% if fb.image1 or fb.image2 or fb.image3 %}
                            <div class="imgs">
                                {% if fb.image1 %}<a href="{{ fb.image1.url }}" target="_blank"><img class="img" src="{{ fb.image1.url }}" alt="feedback image 1"></a>{% endif %}
                                {% if fb.image2 %}<a href="{{ fb.image2.url }}" target="_blank"><img class="img" src="{{ fb.image2.url }}" alt="feedback image 2"></a>{% endif %}
                                {% if fb.image3 %}<a href="{{ fb.image3.url }}" target="_blank"><img class="img" src="{{ fb.image3.url }}" alt="feedback image 3"></a>{% endif %}
                            </div>
                        {% endif %}

                        {% if fb.admin_reply %}
                            <div class="admin">
                                <div class="adminhead">
                                    <div class="admintitle">Admin Reply</div>
                                    {% if fb.admin_reaction %}<div class="reaction">{{ fb.admin_reaction }}</div>{% endif %}
                                </div>
                                <div class="msg" style="margin-top:8px;">{{ fb.admin_reply }}</div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="pager">
            {% if page_obj.has_previous %}
                <a class="btn btn-outline-secondary pagebtn" href="?page={{ page_obj.previous_page_number }}">← Prev</a>
            {% endif %}
            <span class="pill">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a class="btn btn-outline-secondary pagebtn" href="?page={{ page_obj.next_page_number }}">Next →</a>
            {% endif %}
        </div>

    {% else %}
        <div class="cardx">
            <div class="cardb" style="color:#64748b;">No public feedback yet. Be the first to share your experience.</div>
        </div>
    {% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>
</html>
